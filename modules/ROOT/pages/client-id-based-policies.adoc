= Client ID enforcement
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

[width="100%", cols="5,15"]
|===
>s| Policy Name | Client ID enforcement
>s|Summary      | Allows access only to authorized client applications
>s|Category | Security
>s| Since Mule Version | 3.8.0
.4+>.^s| Returned Status Codes
|401 - Unauthorized or invalid client application credentials
|500 - Bad response from authorization server, or WSDL SOAP Fault error
|===

The Client ID Enforcement Policy restricts access to a protected resource, by only allowing HTTP requests if credentials of client applications already xref:api-contracts-landing-page.adoc[registered to (contracted with) the API being targeted] are provided in each request. In Anypoint Platform, the client ID and client secret pair is also known as credentials.

After the Client ID Enforcement policy is applied, the Mule runtime engine (Mule) caches the information locally and updates it periodically. In addition to performance improvements, caching enables the policy to work offline during connectivity outages. 

Regardless of the state of the management plane, the credentials are enforced with the existing data. Once the connectivity is re-established, the cache resumes periodical updates.

//What information is stored or retrieved. -- Eva to send
//Latest version has encryption. So the information is encrypted.

// How does the policy work?
//Where can you get the inforamtion for the policy--Mariano to send me the information


Default policies that internally enforce client application credentials include:

* xref:rate-limiting-and-throttling-sla-based-policies.adoc[Rate Limiting - SLA-Based Policies]
+
In Mule 3.8.5 or later, the following OAuth 2.0 Token Enforcement policies include a client ID enforcement validation:
* xref:external-oauth-2.0-token-validation-policy.adoc[Mule OAuth 2.0 Access Token Enforcement]
* xref:policy-ping-federate.adoc[PingFederate OAuth 2.0 Token Enforcement]
* xref:policy-openid-connect.adoc[OpenID Connect OAuth 2.0 Token Enforcement]

== Policy Prerequisites and Restrictions

For the policy to work successfully, you must:

* Generate the client ID and client secret credentials from Anypoint Platform.
+
Using client credentials generated outside of Anypoint Platform fails the HTTP request.
* Provide the client ID and client secret pair of the registered client application.
* If using REST console, create a trait in the RAML root and then reference it in every operation of your API affected by policy.
+
To obtain the RAML code to add to the policy, go to the corresponding policy in your API Manager.
//It looks like we might need this for other policies too? If so, we should move it out of here and put it in a central place.
+
image::raml-snippet.png[]


== Policy Implementation Best Practices

If you need to track client application access to your API, apply the Client ID Enforcement policy to makes sure that the client credentials are provided in all HTTP requests. 

//This may be too little info to warrant a section of its own. Let's reassess.


== Configure the Policy

You can configure the policy to extract the client ID and client secret from the HTTP request in different ways using DataWeave 2.0 expressions. If when configuring the policy, the client secret DataWeave 2.0 expression is not specified, then only the client ID specified in the HTTP request is validated against the protected resource.

When an HTTP request is performed against a protected resource for which the Client ID Enforcement policy is applied, and the client application credentials are invalid or unauthorized, the HTTP response includes a WWW Authenticate header with the following values:

[width="100%", cols="2,70"]
|===
>s| Custom mode | Header 'WWW-Authenticate'='Client-ID-Enforcement'
>s| Basic Auth mode | Header 'WWW-Authenticate'='Basic realm="mule-realm"
|===


=== Configure Parameters

The following examples use client ID as '1234' and client secret as 'abcd'.

//Eva--this is where we need to specify the parameters that we see in the UI.



==== With HTTP Headers

Example request using curl:
[source,text]
----
curl "http://localhost/myResource" -H "client_id:1234" -H "client_secret:abcd"
----

Example DataWeave 2.0 expression to be used when configuring the policy:
[source,text]
----
#[attributes.headers.['client_id']]
#[attributes.headers.['client_secret']]
----

==== With HTTP Query Parameters

Example request using curl:
[source,text]
----
curl "http://localhost/myResource?client_id=1234&client_secret=abcd"
----

Example DataWeave 2.0 expression to be used when configuring the policy:
[source,text]
----
#[attributes.queryParams.'client_id']
#[attributes.queryParams.'client_secret']
----

==== With HTTP Request Payload
Example request using curl:
[source,text]
----
curl "http://localhost/myResource" -d '{"client_id":"1234", "client_secret":"abcd"}' -X POST
----

Example DataWeave 2.0 expression to be used when configuring the policy:
[source,text]
----
#[payload.client_id]
#[payload.client_secret]
----

==== With Basic Authorization header
Example request using curl:
[source,text]
----
curl "http://localhost/myResource" -u 1234:abcd
----

Example DataWeave 2.0 expression to be used when configuring the policy:

To use the Basic Authentication as the origin of the credentials, no DataWeave 2.0 expression needs to be specified when configuring the policy.


=== Configure API Specifications
//What to add here? -- Eva (this is not needed?)


== See Also

* xref:rate-limiting-and-throttling-sla-based-policies.adoc[Rate Limiting - SLA-Based Policies concepts]
* xref:policy-ping-federate.adoc[PingFederate OAuth 2.0 Token Enforcement]
* xref:policy-openid-connect.adoc[OpenID Connect OAuth 2.0 Token Enforcement]
//* xref:external-oauth-2.0-token-validation-policy.adoc[Mule OAuth 2.0 Access Token]
* xref:defining-sla-tiers.adoc[Reviewing SLA Tiers concepts on API Manager]
* xref:manage-client-apps-latest-task.adoc[Managing API instance Contracts on API Manager]
* xref:access-client-app-id-task.adoc[Getting Client ID and Client Secret of a registered Client App]
