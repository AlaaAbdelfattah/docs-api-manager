= API Proxy
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: proxy, api, auto-generated, raml, wsdl, apikit, http

API proxies, also known as "autogenerated proxies", are meant to enhance the usability of API Manager in your Mule application.

*Typical usage*: Either when you want to leverage API Gateway capabilities and your backend API is not based on Mule Runtime, or when your API is based on Mule Runtime but you are unable to define the corresponding Autodiscovery element because it is a closed code.

image::api-gateway-capabilities-mule4-62bf9.png[align=center]

When you configure your API to be a Proxy Endpoint, Anypoint Platform allows you to download a preconfigured Mule application. If the application is deployed to a Mule Runtime and you are using the correct Platform Credentials, the API for the application will be automatically tracked by API Manager.

You do not need to know how to create a Mule application. You simply deploy the application to a correctly configured runtime.

[NOTE]
Anypoint Platform can deploy the proxy directly to CloudHub or using the Mule agent, through Runtime Manager.

If you would like to use HTTPS instead of HTTP, you can follow these steps:

. Import the autogenerated proxy into Anypoint Studio.
. Specify the certificates to be used.
. Deploy the application to Cloudhub or a runtime instance.

The proxies that can be downloaded from API Platform are a convenient tool to speed up your Application Network development. +
Having said that, you are not restricted to using an autogenerated proxy. Any Mule application, provided with a correctly configured Autodiscovery, can be used to leverage API Gateway capabilities.

== API Proxy Versioning

API Proxies follow their own versioning. When creating an API proxy, API Manager always uses the latest proxy version available. +
API Proxy version 2.0.0 and later add native support for OAS API specification and are also compatible with RAML 1.0 specifications.

You can specify the version of the proxy you want to use by clicking the *Advanced Options* drop-down menu and selecting the proxy version that best covers your needs.

== API Proxy Validations

You can configure API proxies to perform validations on all incoming requests against the API definition you design. Depending on the Mule runtime and API Proxy version you installed, you can modify these validation settings in API Manager and redeploy the proxy in Mule Rumtime. 

With Mule 4, you can apply strict validations as well as regular validations. for your API proxies. Additionally, you can also edit proxies directly from API Manager based on the API proxy version. For more information, see the "Default Setting by API Proxy Versions" table in this section.

=== Regular Validations

Regular validations enable applications to compare a request with API specifications. If the proxy receives a query parameter or a header that is not specified in the definition, that parameter is irrespectively sent to the backend service. You can perform regular validations with WSDL and REST/RAML proxies. As part of the regular validations for REST/RAML proxies, the payload (schema), query parameters, URI parameters, headers, and form parameters are validated. For WSDL proxies, the envelope is validated against the structure provided in the WSDL file.


=== Strict Validations

Strict validations enable applications to compare a request with proxy specifications and allow only those headers and query parameters that are specified in the API definition. You can perform strict validations for only query parameters, only headers, or for both. This feature is currently available only for RAML and WSDL proxies in Mule 4. 

The following tables describe the default settings for API proxies based on different Mule versions:


==== Default Setting by API Proxy Versions for Mule 3.x Applications

[%header%autowidth.spread]
|===
| Mule Version | API Proxy | Default Setting
| 3.7x and below | RAML | Disabled 
| 3.7x and below | WSDL | Disabled 
| 3.8x and above | RAML | Disabled 
| 3.8x and above | WSDL | Disabled 
|===

Mule 3.x applications and API proxy compatibility synopsis:

* Only regular proxy validations are available for Mule 3.x applications.
* Validations are performed for only WSDL and RAML proxies.
* Proxies are not versioned in Mule 3.x applications.
* You can edit proxies from API Manager for Mule 3.8.x and above.


==== Default Setting by API Proxy Versions for Mule 4.x Applications

[%header%autowidth.spread]
|===
| Mule Version | API Proxy | Default Setting
| 4.x| RAML 1.1.3 and below  | Enabled 
| 4.x| RAML 1.2.0            | Enabled 
| 4.x| REST 2.0.0            | Enabled 
| 4.x| REST 2.1.0 and above  | Enabled 
| 4.x| WSDL 1.2.0 and below  | Disabled 
| 4.x| WSDL 1.2.1 and above  | Disabled 
|===

Mule 4.x applications and API proxy compatibility synopsis:

* For Mule 4.x applications, both regular and strict validations are available.
* Validations are performed for only WSDL and RAML/REST proxies.
* Proxies are versioned in Mule 4.x applications. 
* You can edit RAML/REST proxies from API Manager for RAML proxy version 1.2.0 and REST proxy version 2.1.0 and above.


=== API Specifications for Strict Validations

When enabling strict validations for Mule 4 applications, you must consider your API architecture. If your Mule application has a proxy or a load balancer in front of it, the web server might modify the client request to include additional headers. In such cases, the Mule application denies the incoming request due to a non-valid header error. 


==== Runtime Fabric headers

The following headers are added by Edge in Runtime Fabric:

`headers:
  x-correlation-id:
    type: string
  x-forwarded-for:
    type: string
  via:
    type: string
  x-forwarded-host:
    type: string`

Therefore, consider adding these headers in the API specification when using Edge.





== See Also

* xref:proxy-advantages.adoc[Reviewing API Proxy Benefits and Impacts]
* xref:wsdl-raml-http-proxy-reference.adoc[Handling API Proxy status codes]
* xref:https-reference.adoc[Configuring an HTTPS Endpoint]
* xref:proxy-latest-concept.adoc[Deploying an API Proxy]
* xref:proxy-deploy-cloudhub-latest-task.adoc[Deploying an API Proxy to CloudHub]
* xref:proxy-deploy-hybrid-latest-task.adoc[Deploying an API Proxy to Hybrid]
* xref:download-proxy-task.adoc[Downloading an API Proxy]
* xref:proxy-deploy-raml-oas-proxy.adoc[Building a RAML/OAS API Proxy]
* xref:apikit::validate-4-task.adoc[Validating query parameters and headers]
