= Mule OAuth 2.0 Client Store Configuration
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

Mule OAuth 2.0 Client Store allows the Mule OAuth 2.0 Provider to use Anypoint Client Applications for token generation.

This feature is available for Mule 4.2.0 and later.

To prevent downtime of the Provider in case of errors when connecting to the platform, this Client Store caches each valid Client Application for which a token is requested. When a new token is requested and there is no connection, the Client Store fallbacks to the cache. The expiration of its entries has a default of 30 days though it can be configured. You can also set it to persist the cache locally to ensure service availability in case of a restart and lack of connection to the platform. In case a Client Application is removed from Anypoint Platform, and a token has already been provided, on the next token request, the Client Store will remove the Client from the cache, mirroring the platform status.


== Client Store Properties

== OAuth 2.0 Client Store Properties

The Object Store has two configurable properties:
[%header%autowidth.spread,cols="a,a"]
|===
| `anypoint.oauth_provider.cache_persistence_enabled`
| Defines whether the caching mechanism should persist locally. The default value is `true` for when the property is not set or cannot be parsed. Cache persistence allows client authorization without connection to Anypoint Platform.

| `anypoint.oauth_provider.cache_ttl_days`
| Represents how many days each Client Application should be cached by the OAuth Server. This value can be any positive floating point number. The default configuration is `30`, representing 30 days.
|===

== Usage

To set the Mule OAuth Client Store in your OAuth Provider, use the following Object Store in the 'clientStore' parameter of the oauth-provider:config element.

[source,xml,linenums]
----
...
    <mule xmlns:os="http://www.mulesoft.org/schema/mule/os"
      xmlns:agw-client-store="http://www.mulesoft.org/schema/mule/agw-client-store"
      xsi:schemaLocation="
        http://www.mulesoft.org/schema/mule/agw-client-store http://www.mulesoft.org/schema/mule/agw-client-store/current/mule-agw-client-store.xsd
        http://www.mulesoft.org/schema/mule/os http://www.mulesoft.org/schema/mule/os/current/mule-os.xsd">

    <os:config name="agwConfig">
        <agw-client-store:connection/>
    </os:config>

    <os:object-store name="clientObjectStore" config-ref="agwConfig"/>
...
----

Remember that the following dependency must be added to the project, and that the application min Mule version must be 4.2.0 or higher.

[source,xml,linenums]
----
...
    <dependency>
        <groupId>com.mulesoft.anypoint</groupId>
        <artifactId>api-gateway-oauth2-client-store</artifactId>
        <version>1.0.0</version>
        <classifier>mule-plugin</classifier>
    </dependency>
...
----

== See Also

* https://docs.mulesoft.com/mule-runtime/4.1/installing-an-enterprise-license[Install Enterprise License]
* https://docs.mulesoft.com/api-manager/2.x/org-credentials-config-mule4[Setting startup credentials]
* https://docs.mulesoft.com/api-manager/2.x/mule-oauth-provider-landing-page[Mule OAuth 2.0 Provider]
* https://docs.mulesoft.com/mule-runtime/3.9/mule-object-stores[Mule Object Store]