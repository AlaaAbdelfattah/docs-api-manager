

// == Securing a Subset of the API

// You can add security to create, update, and delete operations, leaving read-only operations unsecured. For example, you want to apply an HTTP basic authentication policy to specific methods and resources. Select POST, PUT, PATCH and DELETE methods and use the following expression to cover every resource URI of the API:

// `.*`

// This expression enforces security on write operations, leaving GET (read-only) unsecured. Use a more specific expression to covering just a subset of the resources.

// == Setting Different Limits on Resources

// You can enforce rate limiting to user-specific operations with different limits depending on the user action. You can apply rate limiting, for example, multiple times, limiting requests to a greater extent for some resources than others. For example, you can set different limits for read, create, and delete operations per user on the following nodes:

// ----
//  /api/users/.*/.* â†’
//    /api/users/{userId}/assignments;
//    /api/users/{userId}/assignments/{param}/values;
//    /api/users/{userId}/permissions;
//    /api/users/{userId}/permissions/{permissionId}
// ----

// First, you apply a rate limiting policy to specific methods and resources, selecting the GET (read) method and using the following regular expression:

// ----
// /api/users/.*/.*
// ----

// You then configure the policy to limit requests to 100 requests per 1 hour, for example.
// // This for me should go in a different section. Maybe we can review with you and Chirag to confirm, but it puts two important aspects in a long document and it might get lost. - Eva?
// Next, you apply the rate limiting policy to specific methods and resources again, but selecting the POST (create) method and using the same regular expression as before. Configure 50 requests per 1 hour.

// Finally, you can apply the rate limiting policy again to specific methods and resources, selecting the DELETE method. This time, you use and the same regular expression as before. For example, you can configure 25 requests per 2 hours.

// == Policy Components

// A policy consists of the following components:

// * YAML file
// +
// Defines the configurable parameters of the policy. Rendered by the UI to display the input of the policy.
// +
// * XML template
// +
// Contains the implementation of the policy.
// * Template's POM
// // Is it clear in the navigation that this is only for Mule 4? Mule 3 policies don't have a POM or a descriptor. -- Eva?
// // What is POM?
// +
// Defines policy dependencies. Packaging type needs to be `mule-policy`.
// * Resources
// +
// Optionally if the policy depends on other resources, such as a certificate, define resources as part of the policy.
// +
// * Mule-artifact.json descriptor
// +
// Specify the classifier as `mule-policy`.

// For more information, see the header policy.

//From Eva:

// Each policy is categorized based on its purpose, it can be a security type of policy or a policy that ensures quality of service. When a policies are applied, they modify the behavior of an API based on their purpose, refer to the documentation of each policy for better understanding of what the policy does, the configuration options and examples on how to use it. "

// (Then on the see also I would add the list to the default policies section)

// A policy can modify message content. In Mule 4.1.0 and later, if the message is modified before the `execute-next` in `source` policies
// or after it in `operation` policies, those modifications are not propagated by default. To enable propagation of those modifications
// you can enable the `propagateMessageTransformations` flag in each policy.

// *Example*

// ----
// <http-policy:proxy name="scope-payload">
//     <http-policy:source propagateMessageTransformations="true">

//         <http-policy:execute-next/>

//     </http-policy:source>
//     <http-policy:operation propagateMessageTransformations="true">

//         <http-policy:execute-next/>

//     </http-policy:operation>
// </http-policy:proxy>
// ----

// A policy can avoid the execution of the flow by not defining the `execute-next` or making sure that it is not reached (placing it in a choice, for example).

// Variables set on a policy have only the scope of the policy. Also, variables defined in the flow, are not visible in policies.


// == RAML and OAS-Based APIs

// If your API exposes a RAML or OAS definition that users might need to reference, the API definition must reliably detail every element that is expected in calls to your API. +
// For example, applying a client ID-based policies implies that all requests coming to your API include a client ID and client Secret (by default expected as query parameters). You can prevent user requests from being rejected by creating a trait in the RAML root, and then referencing this trait in all API operations. 

// Example: Create a trait that request APIs to provide Client ID and Client Secret parameters
// [source,yaml,linenums]
// ----
// traits:
//   - client-id-required:
//       queryParameters:
//         client_id:
//           type: string
//         client_secret:
//           type: string
// ----


// Example: Apply the trait in API operations:

// [source,yaml,linenums]
// ----
// /products:
//   get:
//     is: [client-id-required]
//     description: Gets a list of all the inventory products.
// ----

// Policies in Mule 4
// Classloader isolation exists between the application, the runtime and connectors, and policies. To fulfill the isolation requirement, policies are self-contained and packaged to include libraries needed for execution, similar to an application. Additionally, certain changes to the packaging, size, and scope of a policy are introduced in Mule 4.

//* SLA-based policies
//Impose a limit specified by the level of access granted to the requesting application.The Rate Limiting policy is SLA-based.
// Is SLA based a policy level granularity or a configuration level? because it doesn't change where the policy is applied, just the configuration ( a.k.a limit) - Eva??


//[PA: We need to tell the customers how to work with SLA-tiers for policies right?]
//SLA tiers for me should go somewhere else and link to all the documentation on contracts, request api access and those flows. - Eva?