= Policies Overview
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: policy, custom, ootb, offline
//where are we covering what a policy? What the policy does

Policies differ based on several different factors, such as level of granularity,types of policies, and policy categories. You must carefully review these factors, before you decide to implementation them in your environment. In this section, each of these factors are explained in detail. 

// == Policy Components

// A policy consists of the following components:

// * YAML file
// +
// Defines the configurable parameters of the policy. Rendered by the UI to display the input of the policy.
// +
// * XML template
// +
// Contains the implementation of the policy.
// * Template's POM
// // Is it clear in the navigation that this is only for Mule 4? Mule 3 policies don't have a POM or a descriptor. -- Eva?
// // What is POM?
// +
// Defines policy dependencies. Packaging type needs to be `mule-policy`.
// * Resources
// +
// Optionally if the policy depends on other resources, such as a certificate, define resources as part of the policy.
// +
// * Mule-artifact.json descriptor
// +
// Specify the classifier as `mule-policy`.

// For more information, see the header policy.

== Policy Scope

Policies are isolated from the application and other policies. However, there are ways to expose information from a policy. The authentication information about a policy can be propagated in the Security Context Principal object.

//Eva--add info about the generic policy scope Add an example or link here..Fede Balbi?

// A policy can modify message content. In Mule 4.1.0 and later, if the message is modified before the `execute-next` in `source` policies
// or after it in `operation` policies, those modifications are not propagated by default. To enable propagation of those modifications
// you can enable the `propagateMessageTransformations` flag in each policy.

// *Example*

// ----
// <http-policy:proxy name="scope-payload">
//     <http-policy:source propagateMessageTransformations="true">

//         <http-policy:execute-next/>

//     </http-policy:source>
//     <http-policy:operation propagateMessageTransformations="true">

//         <http-policy:execute-next/>

//     </http-policy:operation>
// </http-policy:proxy>
// ----

// A policy can avoid the execution of the flow by not defining the `execute-next` or making sure that it is not reached (placing it in a choice, for example).

// Variables set on a policy have only the scope of the policy. Also, variables defined in the flow, are not visible in policies.

== Policy Size

The size of a policy varies based on its dependencies. The first time Mule Runtime polls for policies it will take longer to fetch them. However, after policies are retrieved, they are cached on the file system. This ensures offline availability and also reduces latency to fetch policies.
//Add more information about the policy size.


// == RAML and OAS-Based APIs

// If your API exposes a RAML or OAS definition that users might need to reference, the API definition must reliably detail every element that is expected in calls to your API. +
// For example, applying a client ID-based policies implies that all requests coming to your API include a client ID and client Secret (by default expected as query parameters). You can prevent user requests from being rejected by creating a trait in the RAML root, and then referencing this trait in all API operations. 

// Example: Create a trait that request APIs to provide Client ID and Client Secret parameters
// [source,yaml,linenums]
// ----
// traits:
//   - client-id-required:
//       queryParameters:
//         client_id:
//           type: string
//         client_secret:
//           type: string
// ----

// Example: Apply the trait in API operations:

// [source,yaml,linenums]
// ----
// /products:
//   get:
//     is: [client-id-required]
//     description: Gets a list of all the inventory products.
// ----

== Policy Level

Policies implement an additional level of granularity, where access is controlled based on the a criteria, called resource-level policies. 
In this level of granularity, policies are applied to only those request that match the criteria.  All policies, except the Cross-Origin Resource Sharing (CORS) policy, are resource-level.

//* SLA-based policies
//Impose a limit specified by the level of access granted to the requesting application.The Rate Limiting policy is SLA-based.
// Is SLA based a policy level granularity or a configuration level? because it doesn't change where the policy is applied, just the configuration ( a.k.a limit) - Eva??


//[PA: We need to tell the customers how to work with SLA-tiers for policies right?]
//SLA tiers for me should go somewhere else and link to all the documentation on contracts, request api access and those flows. - Eva?



Resource level policy support includes RAML and HTTP-based APIs (since Mule 4). A policy applied at a resource level affects all HTTP methods, for example, PUT, GET, POST, or selected HTTP methods, within the resource.

image::methods-resources.png[]

You can apply multiple conditions to filter your resources and HTTP methods. The URI template regex can be applied to one, many, or all the methods that your API has. The uses for resource level policies are limitless. Listed below are a few examples of how you might implement the resource-level policies:

* Applying policies to specific resources
* Securing a subset of an API
* Setting different limits on resources

If you have a RAML/OAS spec attached to your API, click Preview Resource Matching to check which resources your filters affect.

== Policies and SLAs

You create tiers of access, depending on one of the following SLA tiers applied to the application.

* A tier that limits the requests to three per minute. No approval required.
* A tier that limits requests to five per minute and requires API Versions Owner approval of the app that wants to access the API.

With SLAs, you limit access to one API resource. Access to other resources are unlimited. When an app attempts to consume the protected resource, the policy is enforced. The request must include the expected user name and password. Repeated calls within SLA limits from the app to the API succeed; others fail.

//SLA tiers should link to all the documentation on contracts, request api access and those flows.

== Policy Lifecycle

// Add content here -- Eva?
// we should have a section on lifecycle to show how to upgraded to latest versions and promote them to do it.

== See Also

* xref:policies-mule3.adoc[Policies in Mule 3]
* xref:policies-mule4.adoc[Policies in Mule 4]
* xref:policies-policy-categories.adoc[Policy Categories]
* xref:policies-policy-types.adoc[Policy Types]
